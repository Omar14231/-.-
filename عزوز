-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- المتغيرات الأساسية
local player = Players.LocalPlayer
local character = player.Character
local humanoid = character and character:FindFirstChild("Humanoid")
local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")

-- دالة انتظار الشخصية
local function waitForCharacter()
    repeat 
        task.wait(0.5)
        character = player.Character
    until character and character:FindFirstChild("Humanoid") and character:FindFirstChild("HumanoidRootPart")
    
    humanoid = character:FindFirstChild("Humanoid")
    humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    return character, humanoid, humanoidRootPart
end

-- إنشاء واجهة بدون أخطاء
local function createSafeIntro()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AzouzScriptUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    if player:FindFirstChild("PlayerGui") then
        screenGui.Parent = player.PlayerGui
    else
        task.wait(1)
        screenGui.Parent = player:WaitForChild("PlayerGui")
    end
    
    -- الشاشة السوداء البسيطة
    local blackScreen = Instance.new("Frame")
    blackScreen.Name = "BlackScreen"
    blackScreen.BackgroundColor3 = Color3.new(0, 0, 0)
    blackScreen.BackgroundTransparency = 1
    blackScreen.Size = UDim2.new(1, 0, 1, 0)
    blackScreen.Parent = screenGui
    
    -- النص الرئيسي
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Text = "سكريبت عزوز"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextTransparency = 1
    titleLabel.TextSize = 48
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.BackgroundTransparency = 1
    titleLabel.Size = UDim2.new(0, 400, 0, 80)
    titleLabel.Position = UDim2.new(0.5, -200, 0.5, -40)
    titleLabel.TextStrokeTransparency = 0.8
    titleLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    titleLabel.Parent = screenGui
    
    -- صنع عمر
    local creatorLabel = Instance.new("TextLabel")
    creatorLabel.Name = "Creator"
    creatorLabel.Text = "صنع عمر"
    creatorLabel.TextColor3 = Color3.new(1, 1, 1)
    creatorLabel.TextTransparency = 1
    creatorLabel.TextSize = 24
    creatorLabel.Font = Enum.Font.Gotham
    creatorLabel.BackgroundTransparency = 1
    creatorLabel.Size = UDim2.new(0, 150, 0, 40)
    creatorLabel.Position = UDim2.new(1, -160, 1, -50)
    creatorLabel.TextXAlignment = Enum.TextXAlignment.Right
    creatorLabel.TextStrokeTransparency = 0.8
    creatorLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    creatorLabel.Parent = screenGui
    
    -- الإصدار
    local versionLabel = Instance.new("TextLabel")
    versionLabel.Name = "Version"
    versionLabel.Text = "1.2v"
    versionLabel.TextColor3 = Color3.new(1, 1, 1)
    versionLabel.TextTransparency = 1
    versionLabel.TextSize = 20
    versionLabel.Font = Enum.Font.Gotham
    versionLabel.BackgroundTransparency = 1
    versionLabel.Size = UDim2.new(0, 100, 0, 40)
    versionLabel.Position = UDim2.new(0, 20, 1, -50)
    versionLabel.TextXAlignment = Enum.TextXAlignment.Left
    versionLabel.TextStrokeTransparency = 0.8
    versionLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    versionLabel.Parent = screenGui
    
    -- دالة الظهور التدريجي
    local function fadeIn(object, property, targetValue, duration)
        local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(object, tweenInfo, {[property] = targetValue})
        tween:Play()
        return tween
    end
    
    -- دالة الاختفاء التدريجي
    local function fadeOut(object, property, targetValue, duration)
        local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(object, tweenInfo, {[property] = targetValue})
        tween:Play()
        return tween
    end
    
    -- تشغيل المقدمة
    task.spawn(function()
        -- ظهور الشاشة السوداء
        fadeIn(blackScreen, "BackgroundTransparency", 0, 1)
        task.wait(1)
        
        -- ظهور النصوص
        fadeIn(titleLabel, "TextTransparency", 0, 1)
        task.wait(0.5)
        fadeIn(creatorLabel, "TextTransparency", 0, 0.7)
        fadeIn(versionLabel, "TextTransparency", 0, 0.7)
        task.wait(2)
        
        -- اختفاء النصوص
        fadeOut(titleLabel, "TextTransparency", 1, 1)
        fadeOut(creatorLabel, "TextTransparency", 1, 1)
        fadeOut(versionLabel, "TextTransparency", 1, 1)
        task.wait(1)
        
        -- اختفاء الشاشة السوداء
        fadeOut(blackScreen, "BackgroundTransparency", 1, 1)
        task.wait(1)
        
        -- تنظيف الواجهة
        screenGui:Destroy()
    end)
    
    return screenGui
end

-- نظام الحماية الأساسي بدون أخطاء
local function setupBasicProtection()
    -- انتظار الشخصية
    local char, hum, root = waitForCharacter()
    
    -- حماية الصحة
    hum.HealthChanged:Connect(function(newHealth)
        if newHealth <= 0 then
            hum.Health = hum.MaxHealth
        elseif newHealth < hum.MaxHealth then
            task.defer(function()
                if hum and hum.Health < hum.MaxHealth then
                    hum.Health = hum.MaxHealth
                end
            end)
        end
    end)
    
    -- حماية من تغيير الخصائص
    hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
        if hum.WalkSpeed <= 0 or hum.WalkSpeed > 100 then
            hum.WalkSpeed = 16
        end
    end)
    
    hum:GetPropertyChangedSignal("JumpPower"):Connect(function()
        if hum.JumpPower <= 0 or hum.JumpPower > 100 then
            hum.JumpPower = 50
        end
    end)
    
    -- حماية من الأدوات
    char.ChildAdded:Connect(function(child)
        if child:IsA("Tool") then
            task.delay(0.1, function()
                if child and child.Parent == char then
                    child:Destroy()
                end
            end)
        end
    end)
    
    -- حماية من الطيران
    RunService.Heartbeat:Connect(function()
        if root and root.AssemblyLinearVelocity.Magnitude > 100 then
            root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
        end
    end)
    
    -- تأثير بسيط للحماية
    local shield = Instance.new("Part")
    shield.Name = "ProtectionShield"
    shield.Size = Vector3.new(5, 6, 5)
    shield.Transparency = 0.5
    shield.Color = Color3.fromRGB(0, 255, 255)
    shield.Material = Enum.Material.Neon
    shield.CanCollide = false
    shield.Parent = char
    
    local weld = Instance.new("Weld")
    weld.Part0 = root
    weld.Part1 = shield
    weld.C0 = CFrame.new(0, 0, 0)
    weld.Parent = shield
    
    -- تحديث عند موت الشخصية
    player.CharacterAdded:Connect(function(newChar)
        task.wait(1)
        char = newChar
        hum = char:WaitForChild("Humanoid")
        root = char:WaitForChild("HumanoidRootPart")
        
        -- إعادة تطبيق الحماية
        if shield then
            shield:Destroy()
        end
        
        -- إنشاء درع جديد
        shield = Instance.new("Part")
        shield.Name = "ProtectionShield"
        shield.Size = Vector3.new(5, 6, 5)
        shield.Transparency = 0.5
        shield.Color = Color3.fromRGB(0, 255, 255)
        shield.Material = Enum.Material.Neon
        shield.CanCollide = false
        shield.Parent = char
        
        weld = Instance.new("Weld")
        weld.Part0 = root
        weld.Part1 = shield
        weld.C0 = CFrame.new(0, 0, 0)
        weld.Parent = shield
    end)
    
    print("✅ نظام الحماية 1.2v شغال بنجاح!")
end

-- الدالة الرئيسية الآمنة
local function main()
    -- تشغيل المقدمة
    local success, errorMsg = pcall(function()
        createSafeIntro()
    end)
    
    if not success then
        warn("⚠️ خطأ في المقدمة:", errorMsg)
    end
    
    -- تشغيل الحماية بعد المقدمة
    task.wait(5)
    
    local success2, errorMsg2 = pcall(function()
        setupBasicProtection()
    end)
    
    if not success2 then
        warn("⚠️ خطأ في الحماية:", errorMsg2)
        
        -- محاولة بديلة
        task.wait(2)
        pcall(setupBasicProtection)
    end
end

-- بدء التشغيل الآمن
if not pcall(main) then
    -- إذا فشل التشغيل، حاول مرة أخرى
    task.wait(2)
    pcall(main)
end
