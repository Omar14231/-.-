-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

-- المتغيرات
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local screenGui
local blackScreen
local titleLabel
local creatorLabel
local versionLabel
local protectionBox

-- دالة إنشاء واجهة البداية
local function createIntroUI()
	screenGui = Instance.new("ScreenGui")
	screenGui.Name = "AzouzScriptUI"
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.Parent = player:WaitForChild("PlayerGui")
	
	-- الشاشة السوداء
	blackScreen = Instance.new("Frame")
	blackScreen.Name = "BlackScreen"
	blackScreen.BackgroundColor3 = Color3.new(0, 0, 0)
	blackScreen.BackgroundTransparency = 1 -- تبدأ شفافة
	blackScreen.Size = UDim2.new(1, 0, 1, 0)
	blackScreen.Parent = screenGui
	
	-- العنوان "سكريبت عزوز"
	titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "Title"
	titleLabel.Text = "سكريبت عزوز"
	titleLabel.TextColor3 = Color3.new(1, 1, 1)
	titleLabel.TextTransparency = 1
	titleLabel.TextSize = 48
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.BackgroundTransparency = 1
	titleLabel.Size = UDim2.new(0, 400, 0, 80)
	titleLabel.Position = UDim2.new(0.5, -200, 0.5, -40)
	titleLabel.TextStrokeTransparency = 0.8
	titleLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
	titleLabel.Parent = screenGui
	
	-- "صنع عمر" يمين تحت
	creatorLabel = Instance.new("TextLabel")
	creatorLabel.Name = "Creator"
	creatorLabel.Text = "صنع عمر"
	creatorLabel.TextColor3 = Color3.new(1, 1, 1)
	creatorLabel.TextTransparency = 1
	creatorLabel.TextSize = 24
	creatorLabel.Font = Enum.Font.Gotham
	creatorLabel.BackgroundTransparency = 1
	creatorLabel.Size = UDim2.new(0, 150, 0, 40)
	creatorLabel.Position = UDim2.new(1, -160, 1, -50)
	creatorLabel.TextXAlignment = Enum.TextXAlignment.Right
	creatorLabel.TextStrokeTransparency = 0.8
	creatorLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
	creatorLabel.Parent = screenGui
	
	-- "1.1v" يسار تحت
	versionLabel = Instance.new("TextLabel")
	versionLabel.Name = "Version"
	versionLabel.Text = "1.1v"
	versionLabel.TextColor3 = Color3.new(1, 1, 1)
	versionLabel.TextTransparency = 1
	versionLabel.TextSize = 20
	versionLabel.Font = Enum.Font.Gotham
	versionLabel.BackgroundTransparency = 1
	versionLabel.Size = UDim2.new(0, 100, 0, 40)
	versionLabel.Position = UDim2.new(0, 20, 1, -50)
	versionLabel.TextXAlignment = Enum.TextXAlignment.Left
	versionLabel.TextStrokeTransparency = 0.8
	versionLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
	versionLabel.Parent = screenGui
end

-- دالة إنشاء مربع الحماية
local function createProtectionBox()
	protectionBox = Instance.new("Frame")
	protectionBox.Name = "ProtectionBox"
	protectionBox.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
	protectionBox.BackgroundTransparency = 0.8
	protectionBox.Size = UDim2.new(0, 300, 0, 150)
	protectionBox.Position = UDim2.new(0.5, -150, 0.5, -75)
	protectionBox.Visible = false
	protectionBox.Parent = screenGui
	
	-- زوايا دائرية
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 15)
	corner.Parent = protectionBox
	
	-- تأثير إضاءة
	local glow = Instance.new("UIStroke")
	glow.Color = Color3.fromRGB(0, 255, 255)
	glow.Thickness = 3
	glow.Transparency = 0.5
	glow.Parent = protectionBox
	
	-- النص الرئيسي
	local protectionText = Instance.new("TextLabel")
	protectionText.Name = "ProtectionText"
	protectionText.Text = "أنت الآن محمي"
	protectionText.TextColor3 = Color3.fromRGB(0, 255, 255)
	protectionText.TextSize = 28
	protectionText.Font = Enum.Font.GothamBold
	protectionText.BackgroundTransparency = 1
	protectionText.Size = UDim2.new(1, 0, 0.4, 0)
	protectionText.Position = UDim2.new(0, 0, 0.2, 0)
	protectionText.TextStrokeTransparency = 0.7
	protectionText.TextStrokeColor3 = Color3.new(0, 0, 0)
	protectionText.Parent = protectionBox
	
	-- النص الثانوي
	local subText = Instance.new("TextLabel")
	subText.Name = "SubText"
	subText.Text = "الحماية نشطة ضد جميع التهديدات"
	subText.TextColor3 = Color3.fromRGB(200, 200, 200)
	subText.TextSize = 16
	subText.Font = Enum.Font.Gotham
	subText.BackgroundTransparency = 1
	subText.Size = UDim2.new(1, 0, 0.3, 0)
	subText.Position = UDim2.new(0, 0, 0.5, 0)
	subText.Parent = protectionBox
	
	-- أيقونة الحماية
	local shieldIcon = Instance.new("ImageLabel")
	shieldIcon.Name = "ShieldIcon"
	shieldIcon.Image = "rbxassetid://3926305904"
	shieldIcon.ImageRectOffset = Vector2.new(524, 204)
	shieldIcon.ImageRectSize = Vector2.new(36, 36)
	shieldIcon.ImageColor3 = Color3.fromRGB(0, 255, 255)
	shieldIcon.BackgroundTransparency = 1
	shieldIcon.Size = UDim2.new(0, 50, 0, 50)
	shieldIcon.Position = UDim2.new(0.5, -25, 0.8, -25)
	shieldIcon.Parent = protectionBox
end

-- دالة للظهور بالتدريج
local function fadeIn(object, property, targetValue, duration)
	local tweenInfo = TweenInfo.new(
		duration,
		Enum.EasingStyle.Quad,
		Enum.EasingDirection.Out
	)
	
	local tween = TweenService:Create(object, tweenInfo, {[property] = targetValue})
	tween:Play()
	return tween
end

-- دالة للإختفاء بالتدريج
local function fadeOut(object, property, targetValue, duration)
	local tweenInfo = TweenInfo.new(
		duration,
		Enum.EasingStyle.Quad,
		Enum.EasingDirection.Out
	)
	
	local tween = TweenService:Create(object, tweenInfo, {[property] = targetValue})
	tween:Play()
	return tween
end

-- دالة العرض التقديمي
local function playIntro()
	-- 1. ظهور الشاشة السوداء بالتدريج
	fadeIn(blackScreen, "BackgroundTransparency", 0, 1.5)
	task.wait(1.5)
	
	-- 2. ظهور العنوان بالتدريج
	fadeIn(titleLabel, "TextTransparency", 0, 1)
	task.wait(1)
	
	-- 3. ظهور "صنع عمر" بالتدريج
	fadeIn(creatorLabel, "TextTransparency", 0, 0.7)
	
	-- 4. ظهور الإصدار بالتدريج
	fadeIn(versionLabel, "TextTransparency", 0, 0.7)
	task.wait(1)
	
	-- 5. البقاء لمدة 2 ثواني
	task.wait(2)
	
	-- 6. إخفاء كل شيء بالتدريج
	fadeOut(titleLabel, "TextTransparency", 1, 1)
	fadeOut(creatorLabel, "TextTransparency", 1, 1)
	fadeOut(versionLabel, "TextTransparency", 1, 1)
	task.wait(1)
	
	fadeOut(blackScreen, "BackgroundTransparency", 1, 1.5)
	task.wait(1.5)
	
	-- 7. إظهار مربع الحماية
	protectionBox.Visible = true
	fadeIn(protectionBox, "BackgroundTransparency", 0.2, 0.5)
	
	-- تأثير توهج متكرر
	coroutine.wrap(function()
		local glowEffect = protectionBox:FindFirstChild("UIStroke")
		if glowEffect then
			for i = 1, 4 do -- تقليل عدد المرات
				fadeIn(glowEffect, "Transparency", 0.2, 0.6)
				task.wait(0.6)
				fadeOut(glowEffect, "Transparency", 0.5, 0.6)
				task.wait(0.6)
			end
		end
	end)()
	
	task.wait(2.5)
	
	-- 8. إخفاء مربع الحماية بالتدريج
	fadeOut(protectionBox, "BackgroundTransparency", 1, 1)
	local stroke = protectionBox:FindFirstChild("UIStroke")
	if stroke then
		fadeOut(stroke, "Transparency", 1, 1)
	end
	task.wait(1)
	protectionBox:Destroy()
	blackScreen:Destroy()
end

-- =========================================
-- نظام الحماية المتكامل بدون lag
-- =========================================

-- دالة لتطبيق الحماية على الشخصية
local function applyCharacterProtection()
	-- إضافة تأثير الحماية البصرية (لون أزرق سماوي)
	local function addProtectionGlow()
		-- التأثير الأساسي
		local forceField = Instance.new("ForceField")
		forceField.Visible = false -- نخفي ForceField الأصلي
		forceField.Parent = character
		
		-- إنشاء تأثيرنا الخاص
		local protectionGlow = Instance.new("Part")
		protectionGlow.Name = "ProtectionGlow"
		protectionGlow.Size = Vector3.new(6, 7, 6)
		protectionGlow.Transparency = 0.7
		protectionGlow.Color = Color3.fromRGB(0, 200, 255) -- أزرق سماوي
		protectionGlow.Material = Enum.Material.Neon
		protectionGlow.CanCollide = false
		protectionGlow.Anchored = false
		protectionGlow.Parent = character
		
		-- Weld للتأثير
		local weld = Instance.new("Weld")
		weld.Part0 = humanoidRootPart
		weld.Part1 = protectionGlow
		weld.C0 = CFrame.new(0, -0.5, 0)
		weld.Parent = protectionGlow
		
		-- توهج إضافي
		local pointLight = Instance.new("PointLight")
		pointLight.Name = "ProtectionLight"
		pointLight.Color = Color3.fromRGB(0, 200, 255)
		pointLight.Brightness = 2
		pointLight.Range = 15
		pointLight.Shadows = true
		pointLight.Parent = protectionGlow
		
		return protectionGlow
	end
	
	-- حماية أساسية خفيفة
	local function setupBasicProtection()
		-- حفظ القيم الأصلية
		local originalWalkSpeed = humanoid.WalkSpeed
		local originalJumpPower = humanoid.JumpPower
		
		-- حماية من تغيير السرعة
		humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
			if humanoid.WalkSpeed ~= originalWalkSpeed then
				humanoid.WalkSpeed = originalWalkSpeed
			end
		end)
		
		-- حماية من تغيير قوة القفز
		humanoid:GetPropertyChangedSignal("JumpPower"):Connect(function()
			if humanoid.JumpPower ~= originalJumpPower then
				humanoid.JumpPower = originalJumpPower
			end
		end)
		
		-- حماية الصحة (بدون تكرار مفرط)
		local lastHealthCheck = tick()
		humanoid.HealthChanged:Connect(function()
			local now = tick()
			if now - lastHealthCheck > 0.5 then -- فحص كل 0.5 ثانية فقط
				lastHealthCheck = now
				if humanoid.Health < humanoid.MaxHealth then
					humanoid.Health = humanoid.MaxHealth
				end
			end
		end)
	end
	
	-- حماية من الأدوات الضارة
	local function protectFromTools()
		character.ChildAdded:Connect(function(child)
			if child:IsA("Tool") then
				task.wait(0.2)
				if child and child.Parent == character then
					child:Destroy()
				end
			end
		end)
	end
	
	-- الحماية من الطيران (خفيفة)
	local function protectFromFling()
		RunService.Heartbeat:Connect(function()
			if humanoidRootPart and humanoidRootPart.AssemblyLinearVelocity.Magnitude > 150 then
				humanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
			end
		end)
	end
	
	-- تنفيذ الحماية
	local protectionGlow = addProtectionGlow()
	setupBasicProtection()
	protectFromTools()
	protectFromFling()
	
	-- إرجاع التأثير للإزالة لاحقاً
	return protectionGlow
end

-- حماية متقدمة خفيفة
local function setupAdvancedProtection()
	-- حماية من محاولات الطرد (خفيفة)
	spawn(function()
		local mt = getrawmetatable(game)
		if mt then
			local oldNamecall = mt.__namecall
			
			setreadonly(mt, false)
			
			mt.__namecall = newcclosure(function(self, ...)
				local method = getnamecallmethod()
				
				-- منع الطرد فقط
				if method == "Kick" or method == "kick" then
					if tostring(self) == player.Name then
						return nil
					end
				end
				
				return oldNamecall(self, ...)
			end)
			
			setreadonly(mt, true)
		end
	end)
end

-- دالة التشغيل الرئيسية
local function main()
	-- الانتظار حتى يكون اللاعب جاهزًا
	repeat task.wait() until player.Character and player.Character:FindFirstChild("Humanoid")
	character = player.Character
	humanoid = character:FindFirstChild("Humanoid")
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")
	
	-- إنشاء الواجهة
	createIntroUI()
	createProtectionBox()
	
	-- تشغيل العرض التقديمي
	playIntro()
	
	-- تطبيق الحماية على الشخصية
	local protectionGlow = applyCharacterProtection()
	
	-- إعداد الحماية المتقدمة (خفيفة)
	setupAdvancedProtection()
	
	print("✅ نظام الحماية 1.1v نشط بدون lag!")
	
	-- تحديث الشخصية عند الموت
	player.CharacterAdded:Connect(function(newChar)
		character = newChar
		humanoid = character:WaitForChild("Humanoid")
		humanoidRootPart = character:WaitForChild("HumanoidRootPart")
		
		-- إعادة تطبيق الحماية
		task.wait(1)
		if protectionGlow then
			protectionGlow:Destroy()
		end
		protectionGlow = applyCharacterProtection()
	end)
	
	-- إبقاء السكربت نشط بدون ضغط
	while task.wait(10) do
		-- فحص بسيط كل 10 ثواني فقط
		if not character or not character.Parent then
			-- الانتظار لشخصية جديدة
			repeat task.wait() until player.Character
			character = player.Character
			humanoid = character:WaitForChild("Humanoid")
			humanoidRootPart = character:WaitForChild("HumanoidRootPart")
			
			-- إعادة تطبيق الحماية
			if protectionGlow then
				protectionGlow:Destroy()
			end
			protectionGlow = applyCharacterProtection()
		end
	end
end

-- بدء التشغيل
coroutine.wrap(main)()
